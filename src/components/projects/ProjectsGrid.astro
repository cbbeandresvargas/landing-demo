---
// ProjectsGrid.astro - Projects grid section for Projects page
import { getLangFromUrl, useTranslatedPath } from "@i18n/utils";
import { getProjects } from "@utils/projects";
import projectTemplateImage from "@assets/images/projects/project-template.jpg";

const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);

const projects = getProjects(lang).sort((a, b) => new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime());
---

<!-- Projects Grid -->
<section class="projects-grid section py-20">
	<div class="col-span-12">
		<div class="max-w-7xl mx-auto">
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{projects.map((project, index) => (
					<div class="project-card bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden group">
						<div class="aspect-video overflow-hidden">
							<img src={projectTemplateImage.src} alt={project.title as string} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
						</div>
						<div class="p-6">
							<h3 class="text-xl font-bold mb-2 font-mono text-black">{project.title}</h3>
							<p class="text-slate-600 mb-4 line-clamp-2">{project.description}</p>
							<div class="flex items-center justify-between">
								<a 
									href={translatePath(`/work/${project.id}`)}
									class="text-slate-500 hover:text-slate-900 font-mono text-sm uppercase tracking-wide transition-colors"
								>
									{lang === 'es' ? 'Ver Proyecto →' : 'View Project →'}
								</a>
								<span class="text-xs text-slate-400">{project.pubDate}</span>
							</div>
						</div>
					</div>
				))}
			</div>
		</div>
	</div>
</section>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	function init() {
		// Animate project cards
		gsap.from('.projects-grid .project-card', {
			scrollTrigger: {
				trigger: '.projects-grid',
				start: "top 80%",
				end: "bottom 20%",
				toggleActions: "play none none reverse"
			},
			duration: 0.8,
			y: 50,
			opacity: 0,
			ease: "power2.out",
			stagger: 0.2
		});
	}

	document.removeEventListener("DOMContentLoaded", init);
	document.addEventListener("DOMContentLoaded", init);
</script>
